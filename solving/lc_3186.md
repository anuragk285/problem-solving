# Maximal total damage wih spell casting

```python
class Solution(object):
    def maximumTotalDamage(self, power):
        """
        :type power: List[int]
        :rtype: int
        """
        self.total = dict()
        for p in power:
            self.total[p] = self.total.get(p, 0) + p
        
        self.nums = list(set(power))
        self.dp = [-1]*len(self.nums)
        self.nums.sort()
        def bisect_right(target):
            l, r = 0, len(self.nums)
            while l<r:
                mid = (l+r)//2
                if self.nums[mid] <= target:
                    l = mid + 1
                else:
                    r = mid
            return l
        def bt(i):
            if i>=len(self.nums):
                return 0
            elif self.dp[i] != -1:
                return self.dp[i]
            else:
                not_taken = bt(i+1)
                right = bisect_right(self.nums[i] + 2)
                taken = self.total[self.nums[i]] + bt(right)
                self.dp[i] = max(taken, not_taken)
            return self.dp[i]

        return bt(0)
```
